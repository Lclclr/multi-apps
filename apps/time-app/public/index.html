<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Time App</title>
  </head>
  <body>
    <h1>Date & Time</h1>
    <p>This is the Date/Time app (port 8081).</p>
    <p id="time">Loading...</p>
    <p><a id="to-hello" href="/hello/">Go to Hello app</a></p>
    <script>
      async function loadTime() {
        try {
          const res = await fetch("api/time");
          const body = await res.json();
          document.getElementById("time").textContent = body.time;
        } catch (e) {
          document.getElementById("time").textContent = "Error fetching time";
        }
      }
      loadTime();
      setInterval(loadTime, 1000);

      (function () {
        const el = document.getElementById("to-hello");
        if (!el) return;
        const host = location.hostname;
        const port = location.port;
        const path = location.pathname || "/";
        if (path.startsWith("/time")) {
          el.href = "/hello/";
          return;
        }
        // Direct app access at root: link to the other app's host:port
        if (port === "8081" && path === "/") {
          el.href = `${location.protocol}//${host}:8080/`;
          return;
        }
        if (port === "8080" && path === "/") {
          el.href = `${location.protocol}//${host}:8081/`;
          return;
        }
        // Fallback to proxied path
        el.href = "/hello/";
      })();
    </script>
  </body>
</html>
